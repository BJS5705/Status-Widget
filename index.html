<table style="background-color: #1F2127; width: 328px; height: 250px; border: solid #000000 1px; font-family: malgun gothic, Segoe UI, Helvetica, Arial, Sans-Serif;">
    <tbody>
        <tr>
            <!-- 스팀 영역 -->
            <td colspan="2" style="padding: 5px; height: 5px;">
                <div style="display: flex; align-items: flex-start; flex-direction: column;">
                    <img src="https://store.akamai.steamstatic.com/public/shared/images/header/logo_steam.svg?t=962016" alt="Steam Logo" style="width: 68px; height: auto; margin-bottom: 5px;" />
                    <div style="display: flex; align-items: center;">
                        <img id="profile-image" src="https://avatars.akamai.steamstatic.com/cb56471b6bbb734d48054000ceaba827e2776cf3_full.jpg" alt="Profile Image" style="width: 50px; height: 50px; border: solid 3px #666666; margin-right: 5px;" />
                        <div style="color: white;">
                            <div style="margin-bottom: 2px;">
                                <b id="nickname">HEAVEN</b>
                            </div>
                            <div id="steam-status" style="font-size: 12px; color: #CCCCCC; margin-left: 0;">확인 중...</div>
                            <div id="game-title" style="font-size: 12px; color: #8EBF56; display: none;">게임 제목</div>
                        </div>
                    </div>
                </div>
            </td>
        </tr>
        <tr>
            <!-- 구분선 -->
            <td colspan="2" style="border-top: solid 1px white; padding: 0;"></td>
        </tr>
        <tr>
            <!-- 디스코드 영역 -->
            <td colspan="2" align="center" style="color: white; padding-top: 5px;">
                <div style="display: flex; align-items: flex-start; flex-direction: column; margin-top: -85px;">
                    <img src="https://github.com/BJS5705/SteamCard2/blob/main/discordlogo.png?raw=true" alt="Discord Logo" style="width: 65px; height: auto; margin-bottom: 5px;" />
                    <div style="display: flex; align-items: center; position: relative;">
                        <img id="discord-profile-image" src="https://avatars.akamai.steamstatic.com/cb56471b6bbb734d48054000ceaba827e2776cf3_full.jpg" alt="Discord Profile Image" style="width: 50px; height: 50px; border: solid 2px #CCCCCC; border-radius: 50%; margin-left: 3px; position: relative;" />
                        <div style="position: relative; margin-top: 0px; margin-left: 8px;">
                            <div id="discord-small-circle" style="width: 18px; height: 18px; background-color: #1F2127; display: none; align-items: center; justify-content: center; position: absolute; bottom: -25px; right: 6px; border-radius: 50%;">
                                <div id="discord-status-indicator" style="width: 12px; height: 12px; border-radius: 50%; background-color: green; border: solid 2px #1F2127; display: none;"></div>
                            </div>
                        </div>
                        <div style="color: white; margin-bottom: -1px; position: relative;">
                            <div style="margin-left: -91px; position: relative;">
                                <b id="discord-nickname">HEAVEN</b>
                            </div>
                            <div id="discord-status" style="font-size: 12px; color: #CCCCCC; position: relative; left: -1px;">확인 중...</div>
                        </div>
                    </div>
                </div>
            </td>
        </tr>
    </tbody>
</table>

<script>
    async function fetchSteamStatus() {
        const url = '/api/fetchSteamStatus'; // Vercel의 Serverless Function URL

        try {
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`Error: ${response.status} ${response.statusText}`);
            }

            const data = await response.json();
            const player = data.response.players[0];
            const personastate = player.personastate;
            const gameExtraInfo = player.gameextrainfo;

            let statusText = '';
            let statusColor = '#CCCCCC';
            let gameInfoText = '';
            let borderColor = '#666666'; // 기본 테두리 색상

            if (gameExtraInfo) {
                statusText = '게임 중';
                statusColor = '#8EBF56';
                borderColor = '#8EBF56'; // 게임 중 색상
                gameInfoText = gameExtraInfo;
            } else {
                switch (personastate) {
                    case 0:
                        statusText = '오프라인';
                        borderColor = '#666666'; // 오프라인 색상
                        break;
                    case 1:
                        statusText = '온라인';
                        statusColor = '#6BCAF1';
                        borderColor = '#6BCAF1'; // 온라인 색상
                        break;
                    case 2:
                        statusText = '바쁨';
                        statusColor = '#6BCAF1';
                        borderColor = '#6BCAF1'; // 바쁨 색상
                        break;
                    case 3:
                        statusText = '자리 비움';
                        statusColor = '#6BCAF1';
                        borderColor = '#6BCAF1'; // 자리 비움 색상
                        break;
                    case 4:
                        statusText = '잠수';
                        statusColor = '#6BCAF1';
                        borderColor = '#6BCAF1'; // 잠수 색상
                        break;
                    default:
                        statusText = '상태를 알 수 없음';
                }
            }

            // 스팀 상태 업데이트
            const statusElement = document.getElementById('steam-status');
            statusElement.innerHTML = statusText + (gameInfoText ? `<br><span style="font-size: 0.8em; color: ${statusColor};">${gameInfoText}</span>` : '');
            statusElement.style.color = statusColor;
            statusElement.style.fontWeight = gameExtraInfo || personastate === 1 ? 'bold' : 'normal';

            // 프로필 테두리 색상 변경
            const profileImageElement = document.getElementById('profile-image');
            profileImageElement.style.border = `solid 3px ${borderColor}`;

        } catch (error) {
            console.error('Error fetching Steam status:', error);
            document.getElementById('steam-status').innerText = '상태를 불러오지 못했습니다.';
        }
    }

    async function fetchDiscordStatus() {
        const url = '/api/discordStatus'; // Vercel의 Discord 상태 확인 API URL

        try {
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`Error: ${response.status} ${response.statusText}`);
            }

            const data = await response.json();
            const discordStatusElement = document.getElementById('discord-status');
            const discordIndicator = document.getElementById('discord-status-indicator');

            discordStatusElement.innerText = data.status === 'online' ? '온라인' : '오프라인';
            discordIndicator.style.display = data.status === 'online' ? 'block' : 'none';

        } catch (error) {
            console.error('Error fetching Discord status:', error);
            document.getElementById('discord-status').innerText = '상태를 불러오지 못했습니다.';
        }
    }

    fetchSteamStatus();
    fetchDiscordStatus();
</script>
