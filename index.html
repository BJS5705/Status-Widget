<table style="background-color: #1F2127; width: 328px; border: solid #000000 1px; font-family: malgun gothic, Segoe UI, Helvetica, Arial, Sans-Serif;">
    <tbody>
        <tr>
            <!-- 스팀 영역 -->
            <td colspan="2" style="padding: 7px; height: 120px; vertical-align: top;">
                <div style="display: flex; align-items: flex-start; flex-direction: column;">
                    <img src="https://store.akamai.steamstatic.com/public/shared/images/header/logo_steam.svg?t=962016" alt="Steam Logo" style="width: 109px; height: auto; margin-bottom: 8px;" /> <!-- 15% 증가 -->
                    <div style="display: flex; align-items: center;">
                        <img id="profile-image" src="https://avatars.akamai.steamstatic.com/cb56471b6bbb734d48054000ceaba827e2776cf3_full.jpg" alt="Profile Image" style="width: 80px; height: 80px; border: solid 4px #666666; margin-right: 8px;" /> <!-- 15% 증가 -->
                        <div style="color: white;">
                            <div style="margin-bottom: 4px;">
                                <b id="nickname" style="font-size: 30px;">HEAVEN</b> <!-- 15% 증가 -->
                            </div>
                            <div id="steam-status" style="font-size: 25px; color: #CCCCCC;">확인 중...</div> <!-- 15% 증가 -->
                            <div id="game-title" style="font-size: 13px; color: #8EBF56; display: none;">게임 제목</div> <!-- 15% 증가 -->
                        </div>
                    </div>
                </div>
            </td>
        </tr>
        <tr>
            <!-- 구분선 -->
            <td colspan="2" style="border-top: solid 1px white; padding: 0;"></td>
        </tr>
        <tr>
            <!-- 디스코드 영역 -->
            <td colspan="2" style="color: white; padding: 7px 0; text-align: left; height: 160px; vertical-align: top; overflow: auto;">
                <div style="display: flex; align-items: flex-start; flex-direction: column;">
                    <img src="https://github.com/BJS5705/SteamCard2/blob/main/discordlogo.png?raw=true" alt="Discord Logo" style="width: 103.5px; height: auto; margin-bottom: 8px; margin-left: 5px;" /> <!-- 15% 증가 -->
                    <div style="display: flex; align-items: center; position: relative;">
                        <img id="discord-profile-image" src="https://avatars.akamai.steamstatic.com/cb56471b6bbb734d48054000ceaba827e2776cf3_full.jpg" alt="Discord Profile Image" style="width: 80px; height: 80px; border: solid 3px #CCCCCC; border-radius: 50%; margin-left: 4px;" /> <!-- 15% 증가 -->
                        <div id="discord-status-indicator" style="position: absolute; bottom: -4px; left: 60px; width: 21px; height: 21px; border-radius: 50%; background-color: gray; border: solid 5px #1F2127; z-index: 1;"></div>
                        <div style="color: white; margin-left: 11px;">
                            <b id="discord-nickname" style="font-size: 30px;">HEAVEN</b> <!-- 15% 증가 -->
                            <div id="discord-status" style="font-size: 25px; color: #CCCCCC;">확인 중...</div> <!-- 15% 증가 -->
                        </div>
                    </div>
                </div>
            </td>
        </tr>
    </tbody>
</table>

<script>
    async function fetchSteamStatus() {
        const url = '/api/fetchSteamStatus'; // Vercel의 Serverless Function URL

        try {
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`Error: ${response.status} ${response.statusText}`);
            }

            const data = await response.json();
            const player = data.response.players[0];
            const personastate = player.personastate;
            const gameExtraInfo = player.gameextrainfo;

            let statusText = '';
            let statusColor = '#CCCCCC';
            let gameInfoText = '';

            if (gameExtraInfo) {
                statusText = '게임 중';
                statusColor = '#8EBF56';
                gameInfoText = gameExtraInfo;
            } else {
                switch(personastate) {
                    case 0:
                        statusText = '오프라인';
                        break;
                    case 1:
                        statusText = '온라인';
                        statusColor = '#6BCAF1';
                        break; // break 추가
                    case 2:
                        statusText = '바쁨';
                        statusColor = '#6BCAF1';
                        break;
                    case 3:
                        statusText = '자리 비움';
                        statusColor = '#6BCAF1';
                        break;
                    case 4:
                        statusText = '잠수';
                        statusColor = '#6BCAF1';
                        break;
                    default:
                        statusText = '상태를 알 수 없음';
                }
            }

            const statusElement = document.getElementById('steam-status');
            statusElement.innerHTML = statusText + (gameInfoText ? `<br><span style="font-size: 0.8em; color: ${statusColor};">${gameInfoText}</span>` : '');
            statusElement.style.color = statusColor;
            statusElement.style.fontWeight = gameExtraInfo || personastate === 1 ? 'bold' : 'normal';

            // 프로필 이미지 테두리 색상 변경
            const profileImage = document.getElementById('profile-image');
            if (gameExtraInfo) {
                profileImage.style.borderColor = '#8EBF56'; // 게임 중 색상
            } else if (personastate === 1) {
                profileImage.style.borderColor = '#6BCAF1'; // 온라인 색상
            } else {
                profileImage.style.borderColor = '#666666'; // 기본 회색
            }

        } catch (error) {
            console.error('Error fetching Steam status:', error);
            document.getElementById('steam-status').innerText = '상태를 불러오지 못했습니다.';
        }
    }

    async function fetchDiscordStatus() {
        const url = '/api/discordStatus'; // Vercel의 Discord 상태 확인 API URL

        try {
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`Error: ${response.status} ${response.statusText}`);
            }

            const data = await response.json();
            const discordStatusElement = document.getElementById('discord-status');
            const discordIndicator = document.getElementById('discord-status-indicator'); // 여기에서 ID를 가져옵니다.

            // status가 online인지 확인
            discordStatusElement.innerText = data.status === 'online' ? '온라인' : '오프라인';

            // Discord 상태 표시를 위한 인디케이터 처리
            if (discordIndicator) { // discordIndicator가 null이 아닐 때만 실행
                discordIndicator.style.backgroundColor = data.status === 'online' ? 'green' : 'gray'; // 상태에 따라 색상 변경
            }

        } catch (error) {
            console.error('Error fetching Discord status:', error);
            document.getElementById('discord-status').innerText = '상태를 불러오지 못했습니다.';
        }
    }

    fetchSteamStatus();
    fetchDiscordStatus();
</script>
